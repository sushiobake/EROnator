{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://eronator.local/schemas/importBatch.schema.json",
  "title": "ERONATOR Import Batch",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "importMeta",
    "works"
  ],
  "properties": {
    "importMeta": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "version",
        "createdAt",
        "source"
      ],
      "properties": {
        "version": {
          "type": "string",
          "const": "1.0"
        },
        "createdAt": {
          "type": "string",
          "format": "date-time"
        },
        "source": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "kind"
          ],
          "properties": {
            "kind": {
              "type": "string",
              "enum": [
                "tamper_text_block"
              ]
            },
            "note": {
              "type": [
                "string",
                "null"
              ]
            }
          }
        }
      }
    },
    "works": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "workId",
          "cid",
          "title",
          "circleName",
          "productUrl",
          "thumbnailUrl",
          "reviewAverage",
          "reviewCount",
          "isAi",
          "scrapedAt",
          "officialTags",
          "derivedTags",
          "characterTags",
          "textRef"
        ],
        "properties": {
          "workId": {
            "type": "string",
            "minLength": 1
          },
          "cid": {
            "type": [
              "string",
              "null"
            ]
          },
          "title": {
            "type": "string",
            "minLength": 1
          },
          "circleName": {
            "type": "string",
            "minLength": 1
          },
          "productUrl": {
            "type": "string",
            "minLength": 1
          },
          "thumbnailUrl": {
            "type": [
              "string",
              "null"
            ]
          },
          "reviewAverage": {
            "type": [
              "number",
              "null"
            ]
          },
          "reviewCount": {
            "type": [
              "number",
              "null"
            ]
          },
          "isAi": {
            "type": "string",
            "enum": [
              "AI",
              "HAND",
              "UNKNOWN"
            ]
          },
          "scrapedAt": {
            "type": "string",
            "format": "date-time"
          },
          "officialTags": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "uniqueItems": true
          },
          "derivedTags": {
            "type": "array",
            "maxItems": 10,
            "items": {
              "type": "object",
              "additionalProperties": false,
              "required": [
                "displayName",
                "confidence",
                "category"
              ],
              "properties": {
                "displayName": {
                  "type": "string",
                  "minLength": 1
                },
                "confidence": {
                  "type": "number",
                  "minimum": 0,
                  "maximum": 1
                },
                "category": {
                  "type": [
                    "string",
                    "null"
                  ]
                }
              }
            }
          },
          "characterTags": {
            "type": "array",
            "items": {
              "type": "string",
              "minLength": 1
            },
            "uniqueItems": true
          },
          "textRef": {
            "type": "object",
            "additionalProperties": false,
            "required": [
              "baseDir",
              "path",
              "sha256"
            ],
            "properties": {
              "baseDir": {
                "type": "string",
                "const": "data"
              },
              "path": {
                "type": "string",
                "minLength": 1
              },
              "sha256": {
                "type": [
                  "string",
                  "null"
                ]
              }
            }
          }
        }
      }
    }
  }
}