# タグチェック指示書

**この指示書だけを読んで実行する。別ファイルは参照しない。**

---

## ゴール

あなたの仕事は、**各作品を「タグ済」または「人間による確認が必要」のフォルダに移動すること**である。タグ付けはしない。

**完了の定義**: **フォルダが実際に移動した状態**になって初めて完了である。**JSONを返すだけでは完了ではない。** 下記「フォルダを移動するための反映」を**必ず自分で実行し、終えること。それを確実にしろ。**

1. **入力**: 「AIにタグチェックさせるためのコピペ」から得た、作品ごとのデータ（後述）を受け取る。
2. **やること**: その作品について、**「タイトル＋コメント」と「公式タグ＋付け加えたタグ」が対応しているか**をチェックする。問題がなければ**タグ済**、問題があれば**人間による確認が必要**とする。
3. **出力**: 各作品について「タグ済」か「人間による確認が必要」かを判定し、**必ず後述のJSON形式で返す**。人間による確認が必要の場合は**指摘内容**と、**タグを修正した場合は「追加したタグ」「削除したタグ」を私にわかるように表記**する。修正した作品は**人間による確認が必要**として返す。
4. **反映**: 返したJSONを保存し、反映コマンドを**自分で実行する**。手順は下記のとおり。**実行してフォルダを移動させるまで、作業を終えてはならない。**

---

## 目的（タグ付け指示書と同じ）

作品に**正確で差別化できるタグ**（通常タグ＋キャラタグ）が付いているかどうかを見る。  
「タイトル＋コメント」から得られる情報が、**公式タグと付け加えたタグ**で過不足なく反映されているかを確認する。

---

## 入力

「AIにタグチェックさせるためのコピペ」から取得する、1作品あたりのデータ。**1回の入力は最大100件まで。** 100件を超える場合は分割して依頼すること。

- **workId**: 作品ID
- **title**: タイトル
- **commentText**: 作品コメント（あらすじ等）全文
- **derivedTags**: 現在の DERIVED（付け加えたタグ）の表示名の配列
- **officialTags**: 現在の OFFICIAL（公式タグ）の表示名の配列（既存S＋追加Sの両方を含む。コピペ元がそう渡す）。
- **characterName**: 現在のキャラ名（1人分、無ければ null）

---

## チェックの流れと出力

- **チェック待ち**フォルダの作品をあなたがチェックする。
- 問題なし → その作品は**タグ済**とする。
- 問題あり → その作品は**人間による確認が必要**とする。指摘を書き、**タグを直した場合は「追加したタグ」「削除したタグ」を明確に書く**。
- 人間による確認が必要になった作品だけ、私が後で確認する。

出力形式の例（要修正時）:

- **workId**: 作品ID（入力のそのまま）
- **title**: 作品タイトル（入力のそのまま。こちらで照合しやすいよう必ず含める）
- **result**: 「人間による確認が必要」
- **issues**: 指摘のリスト（観点ごとに短く）
- **tagChanges**（タグを修正した場合のみ）:
  - **added**: 追加したタグのリスト
  - **removed**: 削除したタグのリスト

修正したタグは、**私にわかるように表記する**のが鉄則。消したタグも必ず書く。

---

## チェック観点（何を見るか）

### 最優先で見ること（包括的に）

**「タイトル＋コメント」＝「公式タグ＋付け加えたタグ」になっているか。**

- **余計なタグ**が付いていないか（タイトル・コメントに根拠のないタグがないか）。
- **必要なタグ**が付いていないか（タイトル・コメントにある重要な情報が、公式タグまたは付け加えたタグに反映されていないか）。

ここで「過不足なく対応しているか」をまず判定する。

**追加推奨（tagChanges.added）を出す前に、入力の officialTags に同じ語が既に含まれていないか必ず確認すること。** 含まれている場合は追加提案に含めない（公式タグに既にあるので「不足」ではない）。

---

**タイトルから得られる情報は、作品コメントの情報と同様またはそれ以上に重要である。**  
タイトルに含まれる語（合宿・催眠・JK・人妻・総集編 など）は、コメントと同様にタグの根拠として扱う。タイトルを軽く見ない。

---

### 大事なこと（必ず入れる）

**1. キャラタグ（characterName）**

- commentText（あらすじ・登場人物など）に**登場人物の名前**が明記されていれば、**代表1人**が characterName に入っているか。書いていないときは null でよい。
- **作品タイトルはキャラ名ではない。** タイトル文字列を characterName に入れていないか。
- キャラタグの有無・内容は、毎作品で必ず確認する。

---

### 細かいこと（最小限のルール）

**2. 各タグの根拠**

- 付け加えたタグ（DERIVED）のそれぞれに、**タイトルまたは commentText に明確な根拠**があるか。
- 根拠が弱い・推測だけのタグは指摘する。根拠がなければタグが0個でもよい。

**3. その作品の特徴を表すタグがちゃんとついているか**

- 重複の有無より、**「その作品の特徴を表しているか」**を重視する。
- 同義語の重複（幼馴染と幼なじみ、ラブホとホテルなど）や、複合タグと単体タグのかぶりは**細かいこと**の1つ。指摘してよいが、重複は後でタグ統合できる。**まずは「特徴を表すタグが付いているか」を見る。**

**4. シリーズ**

- タイトルに**数字（2, 3, 4 など）**や**「続編」「総集編」「編」**などがあれば、シリーズ系タグ（シリーズもの／続きもの／総集編のいずれか）が1つ付いているか。
- 根拠がなければシリーズ系タグは不要。ここも細かいことの1つとして扱う。

**5. 付けてよいタグ・付けてはいけないタグ**

- **付けてよい**: タイトル・あらすじに**明記**されている語。**背景だけの語（出張・同窓会・夏休みなど）も、意味がある場合が多いので付けてよい。**
- **付けてはいけない（原則）**:
  - メタ情報だけ（続編・後編・Part.1 など形式だけ。シリーズ系タグは別）。
  - 汎用語（快楽・性欲・ヒロインなど差別化にならないもの）。
  - 主軸でない設定だけ（主軸が催眠なのに「学校」だけ、など）。
  - 視点タグ（本文に「〇〇視点」と明記がない限り付けない）。
  - 曖昧・広義すぎるタグ（彼女あり・元カノなど）。

**6. 語彙・表記**

- 誤字・略語・造語（眠姦→睡眠姦、催●→催眠など、正しい表記があるのに誤表記のまま）は指摘する。

---

## タグ修正をする場合

- あなたがタグを**修正してよい**。
- 修正した場合は、**追加したタグ**と**削除したタグ**を、**私にわかるように表記する**。
- 修正した作品は**人間による確認が必要**として出力する。問題がある作品だけ私が確認できるようにする。

---

## 出力形式（まとめ）

**作品ごとに** 次の形式で返す。**workId と title を必ず含める**（どの作品の判定か分かり、こちらで照合しやすくする）。

1作品につき:

- **workId**: 作品ID（入力のそのまま）
- **title**: 作品タイトル（入力のそのまま。照合用に省略しない）
- **result**: 「タグ済」または「人間による確認が必要」
- **issues**（人間による確認が必要の場合）: 観点ごとの指摘。簡潔に。
- **tagChanges**（タグを修正した場合）:
  - **added**: [ 追加したタグ名のリスト ]
  - **removed**: [ 削除したタグ名のリスト ]

省略禁止: 修正したタグは必ず added / removed に書く。各作品に workId と title を必ず書く。

---

## 出力件数（漏れ防止）

- **返す JSON 配列の件数は、必ず入力の作品数と一致させること。** 1件でも書き漏らすと反映時に不整合になる。
- **出力し終えたら、入力に含まれる全 workId が出力配列に1回ずつ含まれているか照合すること。** 漏れがあれば追加してから返す。列挙し忘れは絶対に防ぐ。

---

## フォルダを移動するための反映（必ず自分で実行し、終えろ）

**次の2つをしろ。両方終えるまで作業を完了とするな。**

1. **返したJSONを `data/chatgpt-export/` にファイルとして保存しろ。** ファイル名は例として `check-result.json` でよい。
2. **プロジェクトルートで次のコマンドを実行しろ。** 保存したファイル名に合わせてパスを書く。
   ```bash
   npx tsx scripts/apply-check-result.ts data/chatgpt-export/保存したファイル名.json
   ```
   **入力した作品一覧（AIに渡した配列）をファイルに保存している場合は、第2引数にそのパスを渡すと件数・workId を照合してから反映する。** 漏れがあれば反映せずエラーになる。
   ```bash
   npx tsx scripts/apply-check-result.ts data/chatgpt-export/check-result.json data/chatgpt-export/input-payload.json
   ```
3. 実行が成功すると、各作品のフォルダが **result** の値に応じて「タグ済」または「人間による確認が必要」に移動する。**ここまで終えて初めて完了である。JSONを返しただけでは完了ではない。**

---

## 設計上の前提（実装）

- ブラウザには「**AIにタグチェックさせるためのコピペ**」用のボタンを用意する（タグ付け用のコピペとは文言だけ変える）。
- チェック結果に応じた**フォルダの移動**は、あなたが上記の反映（保存＋コマンド実行）を自分で行うことで行う。管理画面では「タグ済」「チェック待ち」「人間による確認が必要」などフォルダで分かれている。

---

*この指示書は1本で完結させる。運用で新しいパターンが出たら、観点や細かいことのルールを最小限で追加する。*
