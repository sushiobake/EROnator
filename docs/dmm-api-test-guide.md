# DMM Affiliate API テストガイド

DMM Affiliate APIを使用して作品データを取得するためのテスト手順です。

## 前提条件

1. DMM Affiliateに登録済み
2. API IDとアフィリエイトIDを取得済み
3. アフィリエイトIDの末尾が990-999であること（API用、ただし実際の形式はアカウントによって異なる可能性あり）

## DMM API IDの取得方法

DMM Affiliate APIを使用するには、**API ID**が必要です。

### 取得手順（推測）

1. **DMM Affiliate管理画面にログイン**
   - https://affiliate.dmm.com/ にアクセス
   - あなたのアカウント（`sok-001`）でログイン

2. **API設定ページを探す**
   - 管理画面のメニューから「**Webサービス/API**」または「**API設定**」を探す
   - または「**ツール**」→「**API**」などのセクション

3. **API IDを確認**
   - API設定ページに「**API ID**」または「**api_id**」が表示されているはず
   - これをコピーして`.env`ファイルに設定

### もし見つからない場合

- DMM Affiliateのヘルプページを確認
- サポートに問い合わせ：「API IDの取得方法を教えてください」
- 審査が通ったばかりの場合、API IDの発行に時間がかかる可能性があります

### アフィリエイトIDについて

- あなたのアフィリエイトID: `sok-001`
- APIリファレンスでは末尾990-999が必要とされていますが、実際の形式はアカウントによって異なる可能性があります
- まずは`sok-001`で試してみて、エラーが出る場合はDMM Affiliate管理画面でAPI用のアフィリエイトIDを確認してください

## 環境変数の設定

`.env`ファイルまたは`.env.local`ファイルに以下を追加：

```env
DMM_API_ID=Rbb32LFV0FLeUMh5Bn3f
DMM_AFFILIATE_ID=affiliate-990
```

**重要**: 
- **API ID**: `Rbb32LFV0FLeUMh5Bn3f`（2025年1月取得）
- **API用アフィリエイトID**: API登録時に末尾990～999のアフィリエイトIDが発行されます
  - 通常のアフィリエイトID（`sok-001`）とは**別のID**です
  - 管理画面の「Webサービス/API」ページで確認できます
  - 末尾が990～999以外ではエラーとなります
- `DMM_AFFILIATE_ID`が設定されていない場合、`AFFILIATE_ID`が使用されます

## テスト手順

### ステップ1: フロアAPIで漫画フロアを特定

```powershell
npm run test:dmm-floor
```

このコマンドで以下を実行：
1. FANZAの全フロア一覧を取得
2. 漫画関連のフロアを自動検出
3. フロアコードとフロアIDを表示

**出力例**:
```
=== 漫画関連フロア（候補） ===

[FANZA（アダルト）]
  サービス: 電子書籍
  フロア名: コミック
  フロアコード: comic
  フロアID: 25

💡 商品情報APIで使用するパラメータ:
   site: FANZA
   service: digital
   floor: comic
```

### ステップ2: 商品情報APIで100件取得（予定）

フロアが特定できたら、次は商品情報APIで作品を取得します。

（実装予定）

### ステップ3: ジャンル検索APIでタグ情報を取得（予定）

フロアIDが特定できたら、ジャンル一覧を取得します。

（実装予定）

## トラブルシューティング

### エラー: "環境変数が設定されていません"

`.env`ファイルに`DMM_API_ID`と`DMM_AFFILIATE_ID`を設定してください。

### エラー: "affiliate_idは末尾が990-999である必要があります"

API用のアフィリエイトIDは末尾が990-999である必要があります。
DMM Affiliateの管理画面で確認してください。

### エラー: "HTTP error: 401"

API IDまたはアフィリエイトIDが間違っています。環境変数を確認してください。

### エラー: "HTTP error: 403"

アフィリエイトIDの末尾が990-999以外です。API用のアフィリエイトIDを確認してください。

## 次のステップ

1. フロアAPIで漫画フロアを特定
2. 商品情報APIで100件取得してテスト
3. 問題なければ全件取得の実装
4. ジャンル検索APIでタグ情報を補完
