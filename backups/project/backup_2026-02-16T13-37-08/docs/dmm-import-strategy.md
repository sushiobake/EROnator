# DMM API インポート戦略（段階的インポート）

## 問題点

- **現状**: `offset=1` から順にしか取れない → 9900位〜10000位を取るには10000件チェックが必要（非効率）
- **有名順の変動**: 時刻によって同じoffsetでも異なる作品が返る → 漏れが発生しやすい

## 要件

- 漏れが一時的にあってもOK（いずれ網羅できる）
- ある程度有名順で、効率よくインポート
- 最終的には数千〜数万件をDBに入れる

## 解決策：段階的インポート

### 1. オフセット指定可能にする

- フロントで「開始オフセット」を入力できるようにする
- APIは `offset` パラメータを受け取り、その位置から取得する
- 例：`offset=1001` で 1001位〜1100位を取得

### 2. 段階的インポート戦略

**推奨パターン**：
- **第1段階**（上位）: `offset=1`, `target=50` → 1〜50位
- **第2段階**（中位）: `offset=501`, `target=50` → 501〜550位
- **第3段階**（下位）: `offset=2001`, `target=50` → 2001〜2050位
- **第4段階**（さらに下位）: `offset=5001`, `target=50` → 5001〜5050位
- ... 繰り返し

**メリット**：
- 各段階で100件チェック（効率的）
- 有名順を保ちつつ、幅広い範囲をカバー
- 時間をかければ数千〜数万件を網羅可能

### 3. 「次に取るべきオフセット」提案機能

DBの状態を見て、まだ少ない範囲を提案：
- DB内の作品数を確認
- 人気度分布（`popularityBase`）を見て、少ない範囲を特定
- 「次は `offset=XXXX` から取ることを推奨」と提案

### 4. ランダムサンプリング（オプション）

- `sort=date`（新着順）や `sort=price`（価格順）で幅広く取得
- 有名順だけでは見落とす作品を拾う

## 実装

- API: `offset` パラメータを受け取る（既定値: 1）
- フロント: 「開始オフセット」入力欄を追加
- 提案API: `/api/admin/dmm/import/suggest-offset` を追加（DBの状態を見て推奨オフセットを返す）
