# 2021年コミックランキング取得の見解

## 質問内容

2021年の年間コミックランキング1~100位を取得したい。
参考ページ: https://www.dmm.co.jp/dc/doujin/-/ranking-all/yearly/=/submedia=comic/sort=popular/term=all/year=2021/

## 私の見解

### 1. 同人誌フィルタの実装可能性 ✅

**結論: 可能です**

- `imageURL`パスに `/digital/comic/` が含まれるものを同人誌として判定
- ゲーム（`/digital/game/`）、CG集（`/digital/cg/`）、音声（`/digital/voice/`）を除外
- 実装済み: `isDoujinComic()` 関数

### 2. 2021年ランキング取得の可能性 ⚠️

**結論: 部分的に可能ですが、完全一致は難しい可能性があります**

#### 問題点

1. **APIには「年別ランキング」パラメータが存在しない**
   - Webサイトのランキングページは存在するが、APIで直接「2021年のランキング」を指定する方法はない
   - 代わりに、発売日で絞り込む必要がある：
     - `gte_date=2021-01-01T00:00:00`
     - `lte_date=2021-12-31T23:59:59`

2. **ランキングの定義が異なる可能性**
   - Webサイトのランキング: 「2021年の年間ランキング」（2021年時点の人気順）
   - APIの`sort=rank`: 「現在の人気順」（2025年時点での人気順）
   - つまり、2021年発売の作品を現在の人気順で取得することになる

3. **完全一致は期待できない**
   - WebサイトのランキングとAPIの結果が完全一致するかは保証されない
   - ただし、2021年発売の人気作品を取得することは可能

### 3. 実装方針

#### 方法1: 発売日絞り込み + 人気順（推奨）

```typescript
{
  site: 'FANZA',
  service: 'doujin',
  floor: 'digital_doujin',
  sort: 'rank', // 人気順
  gte_date: '2021-01-01T00:00:00',
  lte_date: '2021-12-31T23:59:59',
  hits: 100,
  offset: 1
}
```

**メリット**:
- 2021年発売の作品のみ取得
- 人気順でソート
- 同人誌フィルタでゲーム/CG集を除外

**デメリット**:
- Webサイトのランキングと完全一致するかは不明
- 2021年発売でも、現在の人気が高いものが上位に来る可能性

#### 方法2: レビュー数・評価で並べ替え（代替案）

`sort=review` を使用して、レビュー数・評価順に取得する方法もありますが、これも「現在の評価順」であり、「2021年当時のランキング」ではありません。

### 4. 推奨アプローチ

1. **まず方法1を試す**（発売日絞り込み + 人気順）
2. **結果を確認**して、Webサイトのランキングと比較
3. **一致度を評価**して、必要に応じて調整

### 5. 実装済み機能

- ✅ 同人誌フィルタ（`isDoujinComic()`）
- ✅ 発売日絞り込みパラメータ（`gte_date`, `lte_date`）
- ✅ 人気順ソート（`sort=rank`）

### 6. 次のステップ

1. 2021年のランキング取得をテスト実行
2. 結果を確認して、Webサイトのランキングと比較
3. 必要に応じて、取得方法を調整

## 結論

**取得は可能ですが、Webサイトのランキングと完全一致するかは保証されません。**

ただし、2021年発売の同人誌を人気順で取得することは可能です。まずはテスト実行して、結果を確認することをお勧めします。
