# DMM API インポート検証結果

## ①重複（3件スキップ）の理由

### 結論
**ランキング自体に重複はありません。** 以前のテスト実行（3件取得）で既に保存されていた3件が重複としてスキップされました。

### 詳細
- 最初の100件取得のテスト実行では、以前の3件取得のテスト実行で既に保存されていた3件が重複としてスキップされました
- これは正常な動作です（既存データを保護するため）
- ランキングAPIから同じ作品が複数回返されることはありません

### スキップされた3件（最初の100件取得時）
1. **双子の兄妹強●近親相姦つがいじめ** (d_719191)
   - 作者: 泥中のアイス
   - レビュー: 164件 (平均: 4.16)

2. **バイト先がチートマッサージ店だった件EX2  訪問マッサージ無双編** (d_724670)
   - 作者: にゅう工房
   - レビュー: 14件 (平均: 5.00)

3. **オカネダイスキ2** (d_723019)
   - 作者: メメ屋
   - レビュー: 13件 (平均: 5.00)

## ②最初に保存された5件

1. **双子の兄妹強●近親相姦つがいじめ** (d_719191)
   - 作者: 泥中のアイス
   - AI判定: UNKNOWN
   - レビュー: 164件 (平均: 4.16)
   - タグ: 鬱, 監禁, 専売, 無様, リョナ, 成人向け, バイオレンス, 退廃・背徳・インモラル, 近親相姦, 男性向け, 双子, 動画配信・撮影, 実妹

2. **バイト先がチートマッサージ店だった件EX2  訪問マッサージ無双編** (d_724670)
   - 作者: にゅう工房
   - AI判定: UNKNOWN
   - レビュー: 14件 (平均: 5.00)
   - タグ: 処女, 成人向け, 中出し, 人妻・主婦, 男性向け, おっぱい, 連続絶頂

3. **オカネダイスキ2** (d_723019)
   - 作者: メメ屋
   - AI判定: UNKNOWN
   - レビュー: 13件 (平均: 5.00)
   - タグ: 専売, バニーガール, 成人向け, 中出し, イラマチオ, 男性向け, Ｗフェラ, おっぱい, 後背位／バック, 乱交, フェラ, パイズリ, 巨乳

4. **デリヘル呼んだら、ちょろい王子様がきた話** (d_645166)
   - 作者: しおカフェ
   - AI判定: UNKNOWN
   - レビュー: 26件 (平均: 4.88)
   - タグ: 風俗・ソープ, 専売, ラブラブ・あまあま, 授乳手コキ, キス, 成人向け, 中出し, 寝取られない, 男性向け, 王子様・王子系, 後背位／バック, アヘ顔, 巨乳

5. **ももかちゃんは僕にNTRたいっ！** (d_715711)
   - 作者: ももまろ
   - AI判定: UNKNOWN
   - レビュー: 15件 (平均: 4.00)
   - タグ: 処女, 成人向け, ぶっかけ, 中出し, 男性向け, 寝取り・寝取られ・NTR, 制服, オナニー, BSS, フェラ, 巨乳, ギャグ・コメディ

## 統計情報

- **総作品数**: 108件（100件取得 + 5件追加テスト + 3件以前のテスト）
- **AI判定**: 2件
- **HAND判定**: 0件
- **UNKNOWN判定**: 106件

### 上位10タグ
1. 男性向け: 108件
2. 成人向け: 106件
3. 中出し: 90件
4. 巨乳: 77件
5. 専売: 62件
6. おっぱい: 64件
7. フェラ: 52件
8. 寝取り・寝取られ・NTR: 29件
9. パイズリ: 28件
10. 処女: 22件

## 確認結果

✅ **重複の理由**: 以前のテスト実行で既に保存されていたため（正常な動作）
✅ **最初の5件**: 正常に保存されている
✅ **ランキングの重複**: なし（APIから同じ作品が複数回返されることはない）

## ③ランキング変動の影響

### 結論
**`sort=rank`は確かに時刻とともに変動します。** ただし、短時間での取得（100件程度）では影響は小さいです。

### 詳細
- `sort=rank`は「現在の人気順」を返すため、時刻とともに順位が変動する
- 長時間かかる取得や複数回に分けた取得では、**漏れのリスクがある**
- 短時間での一括取得（100件程度）では、変動の影響は小さい

### 対策
- ✅ **取得時刻の記録**: `createdAt`で既に記録済み
- ✅ **重複チェック**: `workId`で既に実装済み
- ⏳ **取得ログの保存**: どのoffsetで何件取得したかを記録（推奨）
- ⏳ **定期的な再取得**: 漏れを補完するため

詳細は `docs/dmm-ranking-volatility-analysis.md` を参照。

## ④作品の詳細情報（コメント・説明文）

### 結論（再確認後）
**DMM APIのレスポンスには「説明文」や「コメント」フィールドは含まれていません。**

**ChatGPTのディープリサーチ情報との差異**: ChatGPTの情報では「作品詳細コメント – 商品紹介文（comment）も取得できます。」と記載されていましたが、実際のAPIレスポンス（同人誌、電子書籍、動画）を確認したところ、`comment`フィールドは含まれていませんでした。

詳細は `docs/dmm-api-comment-field-verification.md` を参照してください。

### 取得可能な情報
`sourcePayload`に以下の情報が保存されています：

1. **基本情報**
   - title, content_id, product_id, volume, date
   - URL, affiliateURL

2. **価格情報**
   - price, list_price
   - deliveries（配信タイプ別の価格）

3. **画像情報**
   - imageURL（list, small, large）
   - sampleImageURL（サンプル画像、複数枚）

4. **iteminfo詳細**
   - genre（ジャンル）
   - series（シリーズ）
   - maker（メーカー）
   - author（作者）
   - actress（女優）
   - label（レーベル）

5. **レビュー情報**
   - count（レビュー数）
   - average（平均評価）

6. **その他**
   - campaign（キャンペーン情報）

### 取得できない情報
- **商品説明文**: APIレスポンスに含まれていない
- **コメント**: APIレスポンスに含まれていない
- **ユーザーレビューの本文**: APIレスポンスに含まれていない

これらの情報が必要な場合は、商品詳細ページ（`URL`）をスクレイピングする必要がありますが、DMMアフィリエイトのルール上、商品説明文の転載は禁止されています。

## 次のステップ

1. ✅ 100件取得のテスト: 完了
2. ✅ ランキング変動の分析: 完了
3. ✅ 作品詳細情報の確認: 完了
4. ⏳ 準有名タグの取得: 実装待ち
5. ⏳ DBを増やす: 準有名タグ取得後に実施
