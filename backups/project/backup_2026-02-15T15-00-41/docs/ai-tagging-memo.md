# AI分析タグ付けメモ

更新: 2026-02-02

---

## 1. 目的

- **数万件規模の作品**に準有名タグ（A/B/C・追加S・キャラ）をつけて、ゲームで使える「素晴らしいDB」をつくる。
- **人手だけで全件タグ付けするのは現実的ではない**ため、AI（CursorのAgentや別AI）にタグを付けさせ、**人間がチェック・承認する**形で進める。
- 流れ: **未タグ** → AIが分析してタグ保存（→ **チェック待ち**） → 人間が確認して承認（→ **チェック済み**）。承認された作品だけがゲームで使われる。

---

## 2. やり方（運用フロー）

1. **人力タグ付け**の「★未タグ(作品)」から、AIに「N件やっておいて」と依頼する。
2. AIが作品コメント・既存Sタグ・タイトルを見て、**追加S / A / B / C / キャラ**を決め、保存する。  
   保存時に **AI分析** にチェックを入れる → その作品は **★チェック待ち(作品)** に入る。
3. 人間が **チェック待ち** を開き、タグを確認・修正し、**人間チェック** にチェックを入れて保存 → **★チェック済み(作品)** に移動。ゲームで使用可能になる。
4. 問題作は **⚠️要注意** にチェック → **要注意⚠️** タブに隔離され、ゲームには使われない。

### 技術的な保存方法

- 人力タグ付けの **PUT** `/api/admin/manual-tagging/works/[workId]` に、  
  `additionalSTags`, `aTags`, `bTags`, `cTags`, `characterTags`, `aiAnalyzed`, `humanChecked` を送って保存する。
- Agent からは、Prisma で直接同じロジックを実行するスクリプトでも保存可能（API が 500 になる環境向けの代替）。

### スクリプトの説明・一括作業手順

- **一括タグ付け（未タグN件を取得→タグ付け→DB反映）の手順**は **`docs/ai-tagging-batch-workflow.md`** にまとめてある。依頼時に「この感じで○○件やって」と指示された場合はその手順に従う。
- **`scripts/fetch-untagged-works.ts`** … **未タグ作品**をDBから取得し、AIタグ付けの入力用JSONをファイルまたは標準出力に出す。条件は「コメントあり・要注意でない・人間未チェック・DERIVEDタグが1つも付いていない」作品。`take` で件数（例: 10 / 100 / 373）を指定。出力は `workId`, `title`, `authorName`, `commentText`（先頭1200字）, `officialTags` の配列。`scripts/tag-untagged-batch.ts` でタグ付けし、`npx tsx scripts/apply-ai-tagging-batch.ts` でDBに反映する。

---

## 3. 学んだこと（タグ付けルール）

### 優先順位・強さ

1. **タイトルのパワーワードは最優先で入れる**  
   例: 「ヤリチン」「ジャンケン」「文学女子」。タイトル＝その作品のアイデンティティ。
2. **既存のSタグに同じ概念がある場合は 追加S にする**  
   例: 妊娠→「妊娠・孕ませ」、総集編→「ベスト・総集編」、マッサージ、凌辱、後輩、教師 など。Sにない場合はA（例: 凌辱はSにないのでA）。
3. **主人公の特徴はAタグにしてよい**  
   「〇〇が登場する作品？」と聞けるので質問として有効。例: 陰キャ/オタク、底辺。
4. **場所・設定で「核心」でないものはB程度**  
   例: マンションはB。作品の軸ではないので強くしない。

### つけない・弱くするもの

5. **感情・状況のニュアンスで線引きしづらいものは基本的につけない**  
   純愛、マジ惚れ、ガチ恋、助ける、ヒーロー など。質問として「当てはまらない」を説明しにくい。
6. **体型タグは公式S（巨乳・おっぱいなど）以外はつけない**  
   グラマラス、スレンダー などは境界が曖昧で質問にしづらい。
7. **造語・意味が曖昧なものはつけない**  
   複製マ○コ、遠隔、性感開発、身代わり など。同様の言い方が多く、質問として使いにくい。
8. **モノクロ・フルカラーなどは公式タグ以外つけない**  
   つけると運用がややこしくなる。

### シリーズ・形態

9. **総集編は必ずつける**  
   質問として優秀。「総集編」または既存Sの「ベスト・総集編」で。
10. **「シリーズもの」はSタグにある。** タイトルに (2)(3) や 「○○編」 があれば **追加S** で「シリーズもの」を付ける（作品にまだ付いていなければ）。**Aには入れない。** (3)、○○編、橋本編など＝シリーズの一作でないので必ず付ける。
11. **連載・続きものも「シリーズもの」**  
    「41〜50話」「セット【5】」「続・」など、1話完結でないものは **追加S** で「シリーズもの」を付ける（Sに存在し、作品にまだ付いていなければ）。Aには入れない。厳密な「シリーズ」と「連載」の区別は後回しでよい。

### ストーリー・プレイの区別

12. **奴隷 vs 性奴隷**  
    - 奴隷 = ストーリー・世界観の根幹（ファンタジーの奴隷など）。  
    - 性奴隷 = プレイ上の立場。  
    作品の軸に合わせて使い分ける。
13. **3Pは明示されているときだけつける**  
    2Pを二回、と3Pは違う。記載がなければつけない。

### パロディ・固有名

14. **パロディ元は「職業・役割」レベルで**  
    司令官、海賊 などは質問として有効。艦これ系などの作品名はあまり書かず、キャラ名・役割で。
15. **キャラは作品内で名前が出ているヒロイン等**  
    例: ギャル崎、水河陽依、種崎かおり。1作品で主に1キャラなど、運用方針に合わせる。

### 読解の注意（日本語）

16. **時制・焦点を誤読しない**  
    例: 「幼馴染と10年ぶりの再会を果たす**ひと月前に**痴●に襲われ」→ 再会の「前」が焦点。幼馴染が本編でメインかどうかは別途判断。
17. **実際に登場・活躍するかで判断する**  
    タイトルやあらすじに「幼馴染」とあっても、本編でほとんど出てこないならつけない、など。

### その他

18. **同級生/同僚** などがSにあれば 追加S で使用。
19. **同じ意味で表記が違うタグ**（幼馴染 vs 幼なじみ）は現状DBに両方ある。後でまとめて統合する想定。
20. **童貞・処女** は特徴として分かりやすいので、入られるときは **追加S** で入れる（既存Sにあり）。
21. **キャラ** は男の名前・主人公でもOK（例: 寺田暁斗）。ヒロインに限らない。
22. **孕ませ屋** より **精子バンク** のように質問しやすいタグを優先。タイトルにあっても「タグ付けするほどじゃない」ものは避ける。

### チェックフィードバックで学んだこと（2026-02-02）

- **数があればいいのではない。適切なタグが大事。** コメントが薄い作品はSABCタグが少なくとも仕方がない（少なくしろ、というわけではない）。適切なタグがあるなら入れる。
- **勝手な推測で入れるのはNG。** あらすじに学園と言い切れる文章がなければ「学園ラブ」「学園もの」はつけない。作品に「コンプレックス」という言葉が出てこないならつけない。
- **Sタグと被るものは要らない。** タグ付け前に既存Sタグ・タグリストを確認する。授乳がSにあれば「授乳プレイ」はつけない。メイドがSにあれば「メイド教育」はAで重複させない。孕ませがS（妊娠・孕ませ）にあれば **追加S** にする。
- **連載・セットもの・続きもの** はすべてSタグの「シリーズもの」で統一。A/Bで「連載」「セットもの」を重複させない。
- **質問しづらい・答えにくいタグはつけない。** 脱出、絶望など、成人向け漫画として「当てはまる/当てはまらない」を答えにくいものは避ける。
- **曖昧な言葉はつけない。** しきたり、甘やかし、日常H（入れるならBで）、リメイク など定義が曖昧なものは避ける。
- **「〇〇×△△」のような掛け算表記はつけない。** 先生×生徒 など。ヒロインで十分なときは「積極的ヒロイン」ではなく「ヒロイン」にする。
- **断定できない情報はつけない。** 女子高生（女子大生かも）、年齢差 など、テキストから断定できない属性は削除。
- **名詞をつなげてマイナーな言葉にするのはNG。** 「同時授乳」のように、汎用性がなく質問として使いにくい造語はつけない。**汎用性があり、かつ作品の特徴になる**タグを選ぶ。
- **長いより汎用で短い方を。** 没落貴族→貴族で十分。
- **タイトルのパワーワードは逃さない。** 爆乳など、タイトルにある特徴はAタグで拾う。

### 追加で学んだこと（2026-02-02）

- **① メジャーだが特徴ある言葉は積極的に入れる。** 「魔法」など、Sタグにある場合は **追加S** で入れる。
- **② ハプニング** … Aタグにある。**作品にハプニングの記載があるときだけ**入れる。記載がなければ不適切。
- **③ 告白** … 使いやすいので入れる。Aタグにある。
- **④ タイトルの最後に数字がつくとき** … だいたいシリーズもの。**シリーズもの** をつける。
- **⑤ 絶倫** … コメント・タイトルに書いてあるときだけ入れる。書いていないことはタグとして入れない。

### さらに学んだこと（2026-02-02）

- **② 借金** … わかりやすいのでタグとして入れる。コメントにあればAで。
- **④ 魔術書** … 使いやすいので入れる。魔法・魔術と被るが、あとでタグ統合する予定。
- **⑦ 「収録作品」とある** … 総集編なので **追加S**（ベスト・総集編）が適切。
- **⑧ 凌辱・近親相姦・処女** … コメントにあってSに入ってないものは **必ず** 入れる（追加SまたはA）。
- **⑨ ハプニング** … 作品にハプニングの記載がないときは不適切。隣人・アパートはOK。
- **⑩ 書いていないことは入れない。** 搾精・絶倫はコメントに書いてあるときだけ。委員のようにわかりにくい語はNG。「病気」は使いやすい（質問しやすいし答えやすい）ので、コメントに病気要素があれば入れる。

### タグリスト確認・「タグとしてあり得るか」で学んだこと（2026-02-02）

- **タグ付け前に、必ずタグ一覧を開いて確認する。** `config/tagRanks.json`（A/B/Cランク）や `config/officialTagsCache.json` または DB の OFFICIAL 一覧を開き、**同じ意味のタグがすでにないか**確認してから付ける。
- **略語は使わない。正式表記が一覧にあればそれを使う。** シンママ→**シングルマザー**、など。タグ一覧に正式表記（シングルマザー等）があるなら、略語で新規Aタグを作らず、その正式表記で追加SまたはAにする。
- **「その語がタグとして人間の常識としてあり得るか」を毎回考える。** 入り浸り・王権・簒奪のように、ニッチすぎる・ゲームの質問として成立しにくい語はつけない。**「〇〇が登場する作品？」と聞ける、汎用で答えやすい語**だけをAタグにする。タイトルのパワーワードでも、タグとして成立しない語はつけない。

---

## 4. 今後の進め方

- このメモを **更新しつつ**、AI分析タグ付けを続ける。
- 新しいルールや例外が出たら、上記「学んだこと」に追記する。
- 未タグからN件ずつAIがタグ付け → チェック待ち → 人間が承認、のサイクルでDBを増やしていく。

### エージェント向けの注意（指示書に反映済み）

- **AタグをほとんどつけないのはNG。** ゲームで「〇〇が登場する作品？」と質問に使うため、作品の特徴はAタグで積極的に拾う。1作品あたりAタグ2〜5個を目安に。
- **ただし数より「適切さ」を優先。** 勝手な推測・Sと被るもの・曖昧な言葉で数を稼がない。コメントが薄い作品はタグが少なくとも仕方ないが、適切なタグがあるなら入れる。既存S・タグリストを確認してから付ける。

### タグの数・語の選び方（2026-02-02）

- **★いちばん大事なのは「適切なタグをつける」こと。** 個数で打ち切らない。コメント・タイトルに書いてある該当タグは**漏れなく**抽出する。「1個つけたら次の作品へ」のような雑さはNG。例: 「逆レ●プ」「罰ゲーム」がコメントに明記されていれば、両方ともAタグに含める。
- **★追加Sタグ** … 該当があれば**必ず**つける。総集編ならベスト・総集編、義母なら義母 など。
- **★Aタグ** … **結果として**1〜2個が理想、というのは「無理に数合わせしない」意味。適切なタグが3個でも4個でも、コメント・タイトルに根拠があれば**すべて**入れる。0個でも「適切なAがない」ならOK。**不適切なタグで数を稼ぐな**であり、**適切なタグを省略するな**。
- **タグは多すぎない。** 要らないタグはつけない。ほとんど削除されるレベルで多ければ失敗。ただし「適切なタグを少なめにしておく」は失敗。
- **作品固有の造語は使わない。** 例: 「円交」は当該作品の造語なのでNG。同じ概念なら一般的な語で（→**援助交際**）。
- **基本的にコメントにある言葉を使う。** コメントにない語（同級生、催眠など）を勝手につけない。人間操作リモコンなら「人間操作」「常識改変」「制服」「実妹」など**コメントに登場する語**を優先。

### 追加SとAの「流れ」（2026-02-02）

- **「Aを2個抽出したら終わり」ではない。** 理想は **結果として** Aタグが1〜2個つくこと。  
  「2個抽出した→実は両方Sタグだった→追加0で終了」はNG。その場合は第二パスでAを探す。
- **正しい流れ:**
  1. 候補を出す（シリーズもの、ボーイッシュ、義父、田舎 など）。
  2. その候補のうち **既存S（officialTags）にすでにあるもの** → **additionalSTags** に入れる（作品にまだ付いていなければ）。**Aには絶対に入れない。**
  3. SにないものだけをA候補にする。ここでAが0個になることがある（候補が全部Sだった場合）。
  4. **Aが0個なら「もう少しAを探す」** → コメント・タイトル・テーマで、**Sタグにない**適切な語がもうあれば1〜2個追加。本当に適切なAがなければ「適切なAがない」として **A=0で終わり**。
- **例（義父に抱かれる妻 由衣編 総集編 d_711580）:**  
  シリーズものは**Sタグにすでにある**ので追加SにはするがAには入れない。追加Sはベスト・総集編・叔父・義父で十分。この作品には**適切なAタグが他にない**ので、第二パスで探しても見つからず → **A=0でOK**。
- **まとめ:** 候補→既存Sにある語はAに入れない（追加Sに回す）→Sにない語だけA候補→**結果としてAが0なら、もう一度Aを探す**→1〜2個追加 or 適切なタグがなければ0で終了。

### 30件チェック後の学習（2026-02）

人間が30件すべてチェックし、以下の修正が入った。**なぜ漏れたか・何をすべきだったか**を記録する。

- **タイトルのパワーワードを絶対に逃さない。**
  - 「空から**天使**が降りてきた」→ Sタグに「天使・悪魔」があるので **追加S** で入れる。タイトルに天使とあるのに付けていなかった。
  - 「黒髪女の**筆おろし** 2」→ **筆下ろし**（Aタグ）を付ける。タイトルに明記されているのに付けていなかった。
  - 「**悪魔のご褒美**」→ **ご褒美**（Aタグ）を付ける。タイトルそのもの。美化委員だけでなく「ご褒美」を最優先で入れる。
- **既存タグで検索すればSかAかわかる。** 「天使」と入力すれば「天使・悪魔」がSタグだとわかる。それで追加Sに入れる。間違ってAにしても後で統合するから、まずは**適切なタグをつけようとする**ことが大事。
- **コメントに明記された場所・特徴・キーワードは漏らさない。**
  - 「**保健室**で僕は須藤さんを想って抜く」→ 保健室（A）。
  - 「真夏の**海水浴**場」→ 海水浴（A）。
  - 「イケメン**マッチョ**になってしまった」→ マッチョ（A）。
  - 「口下手な**JK**彼女」「巨乳**JK**」→ JK（A）。タイトル・コメントどちらにもある。
- **長いより汎用で短い方を。** 没落貴族→**貴族**で十分（メモ既出）。ユーザーは没落貴族に加えて貴族も採用している。
- **Sタグに同じ概念があるものは追加Sで入れる。** 教師、お嬢様・令嬢、洗脳、巨根、上司、陰キャ・地味、同棲、風紀委員 など、既存Sにある概念で作品に当てはまるものは**追加S**で付ける。Aに入れていたもののうち、Sに存在するものはユーザーがSに移している。
- **キャラはフルネームでも可。** 「華恵」ではなく「花澤華恵」で採用されている場合がある。作品・ユーザー方針に合わせる。
