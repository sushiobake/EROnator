# AIタグ抽出の「難しいところ」と改善の方向性

ChatGPT連携で「あらすじ要約 → 特徴に合うタグ選択 → なければ提案」を行う際、どこがAIに難しく、どう指示すれば改善するかの考察です。

---

## 作業の分解

1. **あらすじ・内容解説の把握**（要約に近い）
2. **その特徴に合うタグをリストから選ぶ**（選択）
3. **リストにない場合は適切なタグを提案する**（生成）

---

## どこが難しいか（仮説）

### 要約ができないというイメージはない

- 一般的にLLMは要約は得意。
- 「あらすじ・内容解説を探す」「特徴を理解する」は、プロンプトで明示していれば十分できる想定。
- **難しさの中心は「要約」より「選択の一貫性」と「禁止リストの遵守」の可能性が高い。**

### タグの「選ばせ方」がイマイチな可能性

- **選択肢が長い**: OFFICIAL＋Aランク＋Bランクを全部テキストで渡していると、どれを優先すべきか曖昧になりやすい。
- **指示が抽象的**: 「ぴったりのタグを選ぶ」「特徴に合う」だけだと、モデルによって解釈がぶれる。
- **改善の方向**:
  - 「まず1文でこの作品の特徴を書く」→「その特徴に合うタグをリストから選ぶ」と**2段階**にすると、思考が固定され選びやすくなる。
  - タグリストを「番号付き」「カテゴリ別」にして、「該当する番号を選ぶ」形式にすると、選択の曖昧さが減る（実装コストはある）。

### 成人向けだから言葉にNGがかかっているか

- GPT-4o 等は成人向けコンテンツの**説明・分類**はある程度許容されているが、**表現の生成**には抑制がかかる場合がある。
- **分類・タグ付け**は「学術的・メタ的な作業」として明示すると、抑制が緩むことがある。
- **改善の方向**:
  - プロンプトに「同人誌の内容を分類・整理するためのメタデータ抽出であり、学術・運営目的で行う」と一言入れる。
  - 「描写を生成しない」「既存のタグ名をそのまま使うだけ」と強調する。

### 内容・個数がイマイチになる要因（推測）

- **0個になりがち**: 「あらすじがない場合は0個」を強く言いすぎると、あらすじが短い・曖昧な場合にも0個に寄りやすい。
- **選ぶタグが偏る**: 「2個を目標に」だけだと、似た観点（例: 場所ばかり）に偏る可能性。
- **改善の方向**:
  - 「観点を分ける」を明示: 「場所・属性・シチュエーション・関係性のうち、複数観点から1つずつ選ぶとよい」。
  - あらすじが短い場合の扱いを一文: 「あらすじが短くても、書かれている情報から推測できるタグは選んでよい」。

---

## プロンプトで試せること（優先度順）

1. **目的の明示**
   - 「同人誌の内容分類のためのメタデータ抽出。描写の生成はしない。既存タグ名をそのまま使用する。」

2. **2段階思考の促し**
   - 「各作品について、まず1文で『この作品の特徴』を書いてから、その特徴に合うタグをリストから選ぶ。」（出力形式に「特徴1文」を入れるかは任意。思考用でもよい）

3. **観点の分散**
   - 「matchedTagsは、できるだけ異なる観点（場所・属性・シチュエーション・関係性など）から選ぶ。」

4. **短いあらすじの扱い**
   - 「あらすじが短くても、コメントに書かれている情報から推測できるタグは選んでよい。完全に内容が不明な場合のみ0個とする。」

5. **ファイル名**
   - すでに `metadata.expectedOutputFileName` を入れて「この名前で保存する」と指示する運用に変更済み。

---

## まとめ

- **難しいのは「要約」より「選択の一貫性」と「禁止・推奨ルールの遵守」の可能性が高い。**
- **改善の切り口**: 目的の明示（学術・分類）、2段階思考（特徴1文→タグ選択）、観点の分散、短いあらすじでも推測可能なら選ぶ許可。
- **黄色タグ**: プレビューで「新規」をオレンジ表示に変更し、Bランクの黄色と区別。isNew 判定で displayName の trim をして照合するようにした。

このドキュメントは、プロンプトを少しずつ変えて試すときの参照用です。
