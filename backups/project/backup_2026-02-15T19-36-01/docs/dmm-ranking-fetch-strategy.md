# 2021年コミックランキング取得戦略

## 目標

2021年の年間コミックランキング1~100位を取得する。

参考ページ: https://www.dmm.co.jp/dc/doujin/-/ranking-all/yearly/=/submedia=comic/sort=popular/term=all/year=2021/

## DMM Affiliate APIの制約

### 確認事項

1. **ランキング順の取得**
   - `sort=rank` パラメータで人気順に取得可能
   - ただし、これは「全体の人気順」であり、「2021年のみの人気順」ではない可能性がある

2. **年別ランキングの取得**
   - APIリファレンスには「年別ランキング」を直接指定するパラメータは**存在しない**
   - 代わりに、発売日で絞り込む必要がある：
     - `gte_date=2021-01-01T00:00:00`（2021年1月1日以降）
     - `lte_date=2021-12-31T23:59:59`（2021年12月31日以前）

3. **ランキングの正確性**
   - WebサイトのランキングとAPIの`sort=rank`が完全に一致するかは**保証されない**
   - APIの`sort=rank`は「現在の人気順」であり、「2021年当時のランキング」ではない可能性がある

## 実装方針

### 方法1: 発売日絞り込み + 人気順（推奨）

```typescript
{
  site: 'FANZA',
  service: 'doujin',
  floor: 'digital_doujin',
  sort: 'rank', // 人気順
  gte_date: '2021-01-01T00:00:00',
  lte_date: '2021-12-31T23:59:59',
  hits: 100,
  offset: 1
}
```

**メリット**:
- 2021年発売の作品のみ取得
- 人気順でソート

**デメリット**:
- Webサイトのランキングと完全一致するかは不明
- 2021年発売でも、現在の人気が高いものが上位に来る可能性

### 方法2: 発売日順 + 手動フィルタ

```typescript
{
  site: 'FANZA',
  service: 'doujin',
  floor: 'digital_doujin',
  sort: 'date', // 発売日順
  gte_date: '2021-01-01T00:00:00',
  lte_date: '2021-12-31T23:59:59',
  hits: 100,
  offset: 1
}
```

**メリット**:
- 2021年発売の作品を確実に取得

**デメリット**:
- ランキング順ではない
- 人気順に並べ替える必要がある

## 推奨アプローチ

1. **まず方法1を試す**（発売日絞り込み + 人気順）
2. **結果を確認**して、Webサイトのランキングと比較
3. **一致しない場合**、方法2で全件取得して、レビュー数や評価で並べ替え

## 注意点

- Webサイトのランキングは「2021年の年間ランキング」であり、APIの`sort=rank`は「現在の人気順」である可能性が高い
- 完全一致を期待するのは難しいが、上位100件を取得することは可能
- 同人誌フィルタ（`/digital/comic/`）を適用して、ゲーム・CG集を除外する必要がある
