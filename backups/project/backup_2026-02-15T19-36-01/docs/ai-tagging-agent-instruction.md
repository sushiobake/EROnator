# AIタグ付けエージェント用 指示書（コピペ用）

**▼ 使い方: このファイルの「---」以下をすべてコピーし、新しいエージェントの最初のメッセージに貼り付ける。そのあと「未タグを10件やって」などと依頼する。依頼例は末尾にあります。**

---

---

## あなたの役割

このプロジェクトでは、**「未タグ」の作品**に、人間が後でチェックするための**タグ（追加S / A / B / C / キャラ）**を付けます。  
あなたは次の流れで作業します。

1. **未タグ作品をN件取得する**（スクリプト実行）
2. **各作品のタイトル・コメント・既存Sタグを読んで、ルールに従いタグを決める**
3. **決めた内容をJSONファイルに書き出す**
4. **適用スクリプトを実行してDBに保存する**（`aiAnalyzed=true`, `humanChecked=false`）

保存された作品は管理画面の「★チェック待ち(作品)」に入り、人間が確認・承認したものだけがゲームで使われます。

---

## 手順（依頼された件数で実行）

### ステップ1: 未タグ作品の取得

プロジェクトルートで以下を実行し、**未タグ作品の一覧（JSON）**を取得します。

- **10件の場合（デフォルト）**  
  ```bash
  npx tsx scripts/fetch-untagged-works.ts
  ```
- **N件にしたい場合**  
  `scripts/fetch-untagged-works.ts` の 17 行目 `take: 10` を `take: N` に変更してから上記コマンドを実行してください。

出力は「workId, title, authorName, commentText（先頭1200字）, officialTags（既存Sタグ名の配列）」の配列です。この出力をそのままタグ付けの入力として使います。

---

### ステップ2: タグ付けルール（必ず守ること）

各作品について、**タイトル・commentText・officialTags** だけを根拠に、次のルールでタグを決めてください。

#### 【重要】追加SとAタグの数・語の選び方

- **★いちばん大事なのは「適切なタグをつける」こと。** 個数で打ち切らない。コメント・タイトルに書いてある該当タグは**漏れなく**抽出する。「1個つけたら次の作品へ」のような雑さはNG。例: コメントに「逆レ●プ」「罰ゲーム」とあれば両方Aタグに入れる。
- **★追加Sタグ** … 該当があれば**必ず**つける（総集編→ベスト・総集編、義母・幼なじみ・叔父・義父など既存Sに同じ概念があれば追加Sで）。
- **★Aタグ** … **結果として**1〜2個が理想、とは「無理に数合わせしない」意味。適切なタグが3個・4個あれば**すべて**入れる。0個でも「適切なAがない」ならOK。不適切なタグで数を稼ぐな、であり、**適切なタグを省略するな**。  
  **「Aを2個抽出したら終わり」ではない。** 抽出した2個が実はSタグだった→その場合はもう少しAを探す。また、コメントに明記された該当タグ（逆レイプ、罰ゲーム、セックスレス、妹 など）は**漏らさず**入れる。
- **タグは多すぎない。** 要らないタグはつけない。
- **作品固有の造語は使わない。** 例: 「円交」は当該作品の造語→**援助交際**のように一般的な語で。
- **基本的にコメント・タイトルにある言葉を使う。** コメントにない語（同級生、催眠など）を勝手につけない。コメントに登場する語を優先する。

#### 【重要】追加SとAの流れ（Sタグと被った場合の第二パス）

1. 候補を出す（シリーズもの、ボーイッシュ、義父 など）。
2. **既存S（officialTags）にすでにあるもの** → additionalSTags に入れる（作品にまだ付いていなければ）。**Aには入れない。**
3. SにないものだけをA候補にする。ここでAが0個になることがある（候補が全部Sだった場合）。
4. **Aが0個なら「もう少しAを探す」** → コメント・タイトルでSにない適切な語がもうあれば1〜2個追加。本当に適切なAがなければ **A=0で終わり**。
- **例:** 「義父に抱かれる妻 由衣編 総集編」→ シリーズものはSにあるのでAには入れない。この作品には他に適切なAがない → A=0でOK。

#### 出力するタグの種類

- **additionalSTags** … 既存の「OFFICIAL（Sタグ）」の**表示名そのまま**で、この作品にも当てはまるもの。**DBにすでに存在するSタグの名前だけ**を書く。不明・無い場合は `[]`。
- **aTags** … 作品の特徴として強く聞きたいもの（Aランク）。**1〜2個が理想。** コメント・タイトルにある語を優先。
- **bTags** … 補助的な特徴（Bランク）。
- **cTags** … 弱い特徴（Cランク）。使わない場合は `[]` でよい。
- **characterTags** … **1作品あたり最大1人**。作品内で名前が出ているキャラ（ヒロイン・主人公どちらでも可）。いなければ `[]`。

#### 優先順位・強さ

1. **タイトルのパワーワードは最優先で漏らさない。**  
   例: 「ヤリチン」「ジャンケン」「文学女子」「**天使**」「**筆おろし**」「**ご褒美**」。タイトル＝その作品のアイデンティティ。タイトルに書いてある語は必ず検討し、既存タグで「天使」→Sの「天使・悪魔」など該当があれば追加S、該当がAならAで入れる。
2. **既存Sタグに同じ概念がある場合は 追加S（additionalSTags）**  
   例: 妊娠→「妊娠・孕ませ」、総集編→「ベスト・総集編」、義母→「義母」、マッサージ、後輩、教師 など。Sにない概念はA/B/Cで。
3. **主人公の特徴はAタグ**  
   「〇〇が登場する作品？」と聞けるものを。例: 陰キャ、オタク、底辺。
4. **場所・設定で「核心」でないものはB**  
   例: マンション、マンションはB。

#### つけない・弱くするもの

5. **感情・状況のニュアンスで線引きしづらいものはつけない**  
   純愛、マジ惚れ、ガチ恋、助ける、ヒーロー など。
6. **体型は公式S（巨乳・おっぱい等）以外つけない**  
   グラマラス、スレンダー などはつけない。
7. **造語・意味が曖昧なものはつけない**  
   複製マ○コ、遠隔、性感開発、身代わり など。
8. **モノクロ・フルカラーは公式タグ以外つけない。**

#### シリーズ・形態

9. **総集編は必ずつける**  
   「総集編」または既存Sの「ベスト・総集編」を additionalSTags に（Sに存在する場合）。
10. **「シリーズもの」はSタグにある。** タイトルに (2)(3) や 「○○編」 があれば **additionalSTags** に「シリーズもの」を入れる（作品にまだ付いていなければ）。**Aには入れない。** (3)、○○編、橋本編など＝シリーズの一作でないので必ず付ける。
11. **連載・続きものも「シリーズもの」**  
    「41〜50話」「セット【5】」「続・」など、1話完結でないものは additionalSTags で「シリーズもの」を付ける（Sに存在し、作品にまだ付いていなければ）。Aには入れない。

#### ストーリー・プレイ

12. **奴隷 vs 性奴隷**  
    奴隷＝ストーリーの根幹、性奴隷＝プレイ上の立場。作品の軸に合わせて使い分ける。
13. **3Pは明示されているときだけ**  
    記載がなければつけない。

#### パロディ・キャラ

14. **パロディは「職業・役割」レベルで**  
    司令官、海賊 など。作品名はあまり書かない。
15. **キャラは作品内で名前が出ている人**  
    1作品で主に1キャラ。男の名前・主人公でも可（例: 寺田暁斗）。

#### 読解の注意

16. **時制・焦点を誤読しない**  
    例: 「幼馴染と10年ぶりの再会の**ひと月前に**痴●に襲われ」→ 再会の「前」が焦点。
17. **実際に登場・活躍するかで判断**  
    あらすじにだけ出て本編でほとんど出てこないならつけない。

#### その他

18. **同級生/同僚** などがSにあれば 追加S で使用。
19. **童貞・処女** は明示されていれば 追加S（既存Sにあり）。
20. **キャラ** は男の名前・主人公でもOK。
21. **孕ませ屋** より **精子バンク** など質問しやすいタグを優先。タイトルにあっても「タグ付けするほどじゃない」ものは避ける。

---

### ステップ3: 出力JSONの形式と保存先

各作品について、次の形のオブジェクトにします。

```json
{
  "workId": "d_xxxxxx",
  "title": "作品タイトル",
  "additionalSTags": ["義母", "ベスト・総集編"],
  "aTags": ["いちゃらぶ", "シリーズもの"],
  "bTags": ["マンション"],
  "cTags": [],
  "characterTags": ["キャラ名"]
}
```

- **workId** … ステップ1の出力の `workId` をそのまま使う。
- **title** … 出力の `title` をそのまま（参照用）。
- **additionalSTags** … 既存OFFICIALの表示名のみ。無い場合は `[]`。
- **aTags / bTags / cTags** … 文字列の配列。無い場合は `[]`。
- **characterTags** … **最大1つ**。無い場合は `[]`。

**保存先**: この配列を **`data/ai-tagging-batch-10.json`** に上書き保存してください。  
（件数が10件でなくても、このファイル名のまま使います。適用スクリプトがこのパスを読みます。）

---

### ステップ4: DBへの反映

プロジェクトルートで以下を実行し、`data/ai-tagging-batch-10.json` の内容をDBに反映します。

```bash
npx tsx scripts/apply-ai-tagging-batch.ts
```

- 既存のDERIVED/追加S/キャラは削除され、今回のタグで上書きされます。
- 各作品は `aiAnalyzed=true`, `humanChecked=false`, `tagSource='ai'` で更新され、「★チェック待ち(作品)」に表示されます。

エラーが出た場合はメッセージを確認し、JSONの形式や workId の一致を確認してください。

---

## 注意事項（まとめ）

- **追加S** は該当があれば必ず。**Aタグは結果として1〜2個が理想。** 候補が全部SだったらA=0になる→そのときは**もう一度Aを探す**。適切なAがなければ0でOK。多すぎ・コメントにない語はNG。
- **additionalSTags** には、**DBに既に存在するOFFICIALタグの表示名だけ**を書く。存在しない名前は無視される。
- **characterTags** は **1作品1人まで**。複数候補がいる場合は代表1人に絞る。
- あらすじ・コメントが無い／薄い作品だけ、タグを少なめにしてよい。**それ以外は多めでよい。**
- ルールにない新語は A/B/C で使ってよいが、**追加Sは既存Sの名前のみ**。
- **30件チェック後の学習（2026-02）:** タイトルのパワーワード（天使→天使・悪魔、筆おろし、ご褒美）を逃すな。既存タグで検索してSかAか確認する。コメントに明記された場所・特徴（保健室、海水浴、マッチョ、JK）は漏らさない。長いより汎用で短い方を（没落貴族→貴族で十分）。

---

## 依頼例（ユーザーがコピペして使う文面）

以下をそのまま新しいエージェントに送れば、上記手順で動きます。

```
未タグの作品を10件、AIタグ付けしてほしい。

手順は docs/ai-tagging-agent-instruction.md に書いてある通りで、
1) scripts/fetch-untagged-works.ts で未タグ作品を取得
2) 同ドキュメントのタグ付けルールに従って各作品の additionalSTags / aTags / bTags / cTags / characterTags を決める。
   ※追加Sは該当があれば必ず。Aタグは結果として1〜2個が理想（候補が全部Sだったらもう一度Aを探す。適切なAがなければ0でOK）。コメントにある語を優先し、造語・多すぎは避ける。
3) 結果を data/ai-tagging-batch-10.json に保存
4) npx tsx scripts/apply-ai-tagging-batch.ts を実行してDBに反映

お願いします。
```

**20件にしたい場合**の依頼例:

```
未タグの作品を20件、AIタグ付けしてほしい。
scripts/fetch-untagged-works.ts の take: 10 を take: 20 に変えてから未タグ作品を取得し、
docs/ai-tagging-agent-instruction.md の手順とルールに従ってタグを決め、
data/ai-tagging-batch-10.json に20件分のJSONを保存したあと、
npx tsx scripts/apply-ai-tagging-batch.ts を実行してDBに反映してほしい。
```

---

以上が、新しいエージェントに渡す指示書の全文です。
