# Cursor 実装指示（v1.5）

この1枚は「Cursorが推測でズレるポイント」を塞ぐための柵。

## 0) 渡すファイル（この順で読む）
1. `MVP_SPEC_v1.5.3_user.md`（挙動の正）
2. `MVP_CONFIG_SCHEMA_v1.5.md`（configキー/型の正）
3. `mvpConfig.example.v1.5.json`（形の見本）

## 1) 絶対に守る（MUST）
- **configのキーは schema 以外追加しない**（スキーマ外キーは起動時エラーにする）
- **決定論**を破る実装をしない
  - Tag tie-break: score同点→`tagKey`昇順
  - Work ordering: `P(w)`降順→`workId`昇順
- 仕様書に書いていない閾値・ルールを推測で足さない
- **works/tags/質問プールの全量をフロントのバンドルに含めない**（server側のみ保持。client側へ配布しない）
- UIは最小（後でv0等で差し替える前提）。スタイルや演出の作り込みはしない。

## 2) 実装の最小ゴール（MVP0 完了判定）
- `MVP_SPEC_v1.5.3_user.md` の §11（17項目）を **自己チェックして全て満たす**

## 3) Compliance/NFR（MVP必須・省略禁止）
- 外部リンクにはPR表記を必ず出す
- リンク文言は固定テンプレ（例「FANZAで見る」）で自動生成しない
- サムネは公式URLを**表示するだけ**。自サーバー保存/キャッシュ禁止。許可ドメイン外なら非表示
  - **許可ホストは推測しない。MVPのデフォルトは allowlist 空（= 常に非表示）で安全側。**
  - 後日、運用側が許可ホストを確定できたら、server側の定数 `ALLOWED_THUMB_HOSTS` を更新して解放する（configキー追加は禁止）。
- `AFFILIATE_ID` は環境変数。本番ドメインのみ本番ID、staging/devはID無し（または別ID）
- READMEに審査用チェックリストを入れる
- READMEに**確実に動く起動手順**を書く（install/devコマンド、ポート、アクセスURL、必要な環境変数名）

## 4) 仕様の衝突が起きたら
- **挙動は spec を正**、**キー/型は schema を正**として揃える。
- 迷った場合は「追加実装」ではなく、まずドキュメントを一致させてから実装する。
## Data exposure policy (MVP必須)

- クライアントへ返してよいのは「表示に必要な最小限の情報」のみ。
- 以下は**絶対にクライアントへ返さない／配布しない**：
  - (a) 質問プール全体、候補質問一覧、質問IDの全量
  - (b) 辞書（正規化辞書・同義語辞書）、tags_ui.tsv 等の全量
  - (c) L1/L2の内部属性（推定根拠/evidence、confidenceの詳細内訳）
  - (d) 候補作品の全量や上位大量リスト（上位K件以上は返さない）
  - (e) ログ（当たり外れ、投票、自由入力）の生データ
- 本番APIのレスポンスは、各エンドポイントごとに返却フィールドを固定し、デバッグ用フィールドは本番で無効化する。

---

## 作業ログの出力フォーマット（毎ラウンド必須：運用の柵）

Cursorは各ラウンドの最後に、必ず次をこの順で出力する（省略禁止）：

1) **変更ファイル一覧**（追加/変更/削除を明記）
2) **実装要約**（何を実装したかを箇条書きで）
3) **自己チェック結果**（Spec §11 / 受け入れ条件(17)に対して、各項目 Yes/No と根拠）
4) **TODO / 懸念**（残課題・不確実点・次ラウンドで詰める点）

※この出力が無い成果物は「未完了」とみなす。
